## Separate and Combine Columns via `separate()` and `unite()`  {#separate-unite-columns}

To introduce the separate and and unite operation, let's first create a tidy data set containing the weight and height of year 2019 to 2021 for a sheep and a pig.
```{r, results=TRUE}
library(tidyr)
library(r02pro)
animal <- rep(c("sheep","pig"), c(3,3))
year <- rep(2019:2021, 2)
weight <- c(110, 120, 140, NA, 300, 800)
height <- c(2.2, 2.4, 2.7, 2, 2.1, 2.3)
animal_tidy <- tibble(animal, year, weight, height)
animal_tidy
```

### Combine Columns via `unite()`

Sometimes, we may want to **combine multiple columns** into a single one. To do this, you can use the `unite()` function in the **tidyr** package. 

In the `unite()` function, you need to specify the name of the to-be created column (`col`), the columns to be combined, and the separator between the columns (`sep`). 
```{r, results=TRUE}
animal_ratio <- animal_tidy %>% 
  unite(col = "ratio", c("weight", "height"), sep = "/") #unite the weight and height into the ratio
animal_ratio
```

Now, the `animal_ratio` has a new column named `ratio` which is displayed as the weight divided by the height. 

### Separate One Column into Multiple Columns Using `separate()`

We know the `unite()` function combine multiple columns into a single column. Sometimes, we need to do the opposite operation, namely separate one column into multiple ones. To do this, you can use the `separate()` function. 

Let's look at the `animal_ratio`, which is a untidy dataset, since the column `ratio` contains the information of two variables. To tidy it, we can use the `separate()` function. In the separate function, you need to specify
- `col`: the name of the column to be separated
- `into`: the desired names of the to-be created columns after separation
- `sep`: the separator during the separation process

```{r, results=TRUE}
animal_ratio %>% 
  separate(col = "ratio", into = c("weight", "height"), sep = "/")
```

From the result, you can see that the original **tidy** tibble is recovered via the `separate()` function. After a careful look, you may notice that the column types of `weight` and `height` are both `character`, which may not be what we want. To convert the types automatically, you can add the `convert = TRUE` argument in the `separate()` function.

```{r, results = TRUE}
animal_ratio %>% 
  separate(col = "ratio", into = c("weight", "height"), sep = "/", convert = TRUE)
```

Now, `weight` is interger and `height` is double. 

In addition to separating via the separator, you can also separate by the position. For example, to separate the year into century (first two digits) and 2-digit year (last 2 digits), you can separate the `year` after position 2. 

```{r, results=TRUE}
animal_tidy %>% separate(col = "year", into = c("y12","y34"), sep = 2, convert = TRUE)
```

You can also separate at multiple locations. For example, to separate the year into four columns, representing four digits, you can use multiple  positions to separate.

```{r, results = TRUE}
anmial_digits <- animal_tidy %>% separate(col = "year", into = c("y1","y2","y3","y4"), sep = 1:3, convert = TRUE)
anmial_digits
```

Using the `animal_digits`, you can also combine all the four digits into a column named `year`.

```{r, results=TRUE}
anmial_digits %>% unite(col = "year", y1:y4, sep = "")
```

Note that here, the seperator is set to be the empty string since we don't want any separator within the four-digit year.
